### å…³äºæäº¤é˜¶æ®µ

  <img src="./imgs/commité˜¶æ®µ.png" />

- æ–‡ä»¶: ReactFiberWorkLoop.old.js ã€ ReactFiberCommitWork.new.js

- ç¬¬ä¸€ã€äºŒé˜¶æ®µ: è°ƒåº¦ä¸åè°ƒæ‰€æœ‰æ“ä½œéƒ½æ˜¯<font size="4" color="green">åœ¨å†…å­˜ä¸­</font>è¿›è¡Œçš„,
  å‰é¢é€šè¿‡å¢é‡æ¯”å¯¹, æ ‡è®° ğŸ“Œ å‡ºæ‰€æœ‰å‰¯ä½œç”¨ä¸éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹, ä½†æ˜¯è¿˜æ²¡æœ‰å®ç°æ›´æ–°ã€‚

- ç¬¬ä¸‰é˜¶æ®µ: çœŸæ­£å®ç°<font size="4" color="red">å‰¯ä½œç”¨ã€çœŸå® domã€ç”Ÿå‘½å‘¨æœŸ</font>å‰é¢çš„è®¡ç®—ç»“æœã€‚

- æäº¤æ˜¯ä¸€æ¬¡æ€§çš„ã€ä¸å¯ä¸­æ–­çš„: <font size="4" color="red">é˜²æ­¢æ¸²æŸ“ä¸ä¸€è‡´ã€ä¿è¯å‰¯ä½œç”¨æ­£ç¡®æœ‰åºçš„æ‰§è¡Œã€‚</font>

- æ ¹æ®ç”Ÿæˆçš„ effectList é“¾è¡¨ä¾æ¬¡æ‰§è¡Œå‰¯ä½œç”¨, ä¸å†éå†æ•´æ£µæ ‘(æ–°ç‰ˆæ•´åœ¨é‡æ„)

- æœ€æ–° Suspense ä¸ OffScreen ç‰¹æ€§å¯èƒ½æ¨ç¿»äº†ä¸Šé¢è¿™æ¡ (HACK)

- ä¸‰ä¸ªå­é˜¶æ®µ(å‰ã€ä¸­ã€å): `BeforeMutation / MutationEffect / MutationLayout`

### æäº¤å…¥å£ä¸ finishedWork

- æˆ‘ä»¬åœ¨åè°ƒé˜¶æ®µåœ¨æ ¹æ®`current`å’Œ`workInProgress`ä¸¤é¢— fiber æ ‘æ‰“äº¤é“,
  è€Œå®Œæˆäº†æ‰€æœ‰æ¯”å¯¹çš„`workInProgress`æ ‘å³å°†æ˜ å°„åˆ°çœŸå® dom, æˆ‘ä»¬åœ¨ commit é˜¶æ®µç§°ä¹‹ä¸º `finishedWork`

- åœ¨ `performConcurrentWorkLoop` å‡½æ•°å…¨é¢æ‰§è¡Œå®Œåè°ƒ(renderRootConcurrent), æ‰§è¡Œ commitRoot æ­£å¼è¿›å…¥æäº¤æµç¨‹
  ```javascript
  root.finishedWork = finishedWork; // å¼€å§‹è¿›å…¥æäº¤
  root.finishedLanes = lanes;
  finishConcurrentRender(root, exitStatus, lanes);
  ```

### ä¸‰ä¸ªå­é˜¶æ®µ

- ```javascript
  commitBeforeMutationEffects; // é˜¶æ®µ1
  // The first phase a "before mutation" phase. We use this phase to read the
  // state of the host tree right before we mutate it. This is where
  // getSnapshotBeforeUpdate is called.

  commitMutationEffects; // é˜¶æ®µ2
  // The next phase is the mutation phase, where we mutate the host tree.

  commitLayoutEffects; // é˜¶æ®µ3
  // The next phase is the layout phase, where we call effects that read
  // the host tree after it's been mutated. The idiomatic use case for this is
  // layout, but class component lifecycles also fire here for legacy reasons.
  ```

### åŒç¼“å­˜åˆ‡æ¢(æ›´æ–°)çš„æ—¶é—´ç‚¹

- æ›´æ–°åŒç¼“å­˜, å°†`workInProgress`æ ‘æ›¿ä»£`current`æ ‘çš„æ—¶æœº: åœ¨ `MutationEffect` ä¹‹å, `Layout` ä¹‹å‰ã€‚

- ```javascript
  root.current = finishedWork;
  // The work-in-progress tree is now the current tree. This must come after
  // the mutation phase, so that the previous tree is still current during
  // componentWillUnmount, but before the layout phase, so that the finished
  // work is current during componentDidMount/Update.
  ```
