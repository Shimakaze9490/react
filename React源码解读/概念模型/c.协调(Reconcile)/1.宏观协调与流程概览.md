### 什么是 React 协调

- <font color="green" size="4">管理 react 应用状态的输入和处理, 将最终处理结果交给渲染器, 完成相应宿主环境的渲染(在 web 环境就是浏览器 dom 更新)</font>

- 这个协调的处理过程是 在<font color="red" size="4">内存</font>中完成前后两次快照的比对,
  找出差异需要更新的节点(diff 算法), 产生新 fiber 树(workInProgress)的过程。
  增量更新所打上的所有 flag 副作用, 表述哪个 fiber 需要更新、哪个需要删除、哪个需要新增。

- 因为所有协调的工作是在内存中进行的, 是 CPU 密集型操作(容易产生阻塞); 同时也是可以增量执行的

- 旧版栈协调: 直接使用的浏览器执行栈, 深度递归整棵树, 称为`栈协调`, 优点是简单方便, 缺点是不能控制中断

- 新版 fiber 协调: 利用 fiber(虚拟栈帧) 作为单位, 模拟递归的方式控制执行中断与恢复,
  能够比较平滑的增量更新, 称为`fiber协调`。

### 执行路径与核心方法

- 新旧两版: 同步执行(LegacyMode), 异步并发执行(ConcurrentMode)

- 文件: ReactFiberWorkLoop.old.js

- 核心方法: `workLoopConcurrent`, 在时间切片内迭代每个 fiber 单位。

- 核心方法: `performUnitOfWork`, 对于每个 fiber 单位, 进行`递操作` 与 `归操作`。

- 入口与调用路径:
  `performConcurrentWorkOnRoot --> renderRootConcurrent --> workLoopConcurrent --> performUnitOfWork --> beginWork 和 completeWork`
