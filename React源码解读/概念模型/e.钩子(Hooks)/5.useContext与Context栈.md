(简略)

### Context 及其用法

- 文件: ReactFiberContext.old.js / ReactFiberStack.old.js

- Context 是可以跨越层级进行数据传递的结构, 相当于 React 在源码级别帮我们多传了一个 otherProps,
  理解的关键在: `context 是可以有多个, 并且是层级嵌套的。`
  登记在`fiber.dependencies`字段

  ```javascript
  export type Dependencies = {
    lanes: Lanes,
    firstContext: ContextDependency<mixed> | null,
  };
  ```

- 三种使用方式(源头都是 createContext): `Provider 与 Consumer` / `class组件的 contextType` / `函数组件的 useContext`;

## 用什么数据结构来维护多个 Context?

- 由近及远的查找 Context, 答案: `链表 + 栈`

  ```javascript
  <Context value={{ name: 'Tom', age: '20' }}> // 进栈
      <div>A: {{name}}, {{ age }}</div>
      <Context value={{ name: 'Jack' }}> // 进栈
          <div>B: {{name}}, {{ age }}</div> // <---- 考虑这里的输出: Jack, 20
      </Context> // 出栈
      <Context value={{ name: 'Alice', age: '30' }}> // 进栈
          <div>C: {{name}}, {{ age }}</div> // <---- 考虑这里的输出: Alice, 30
      </Context> // 出栈
  </Context> // 出栈
  ```

- 简单说就是: 遇到<Context>入栈, 遇到</Context>出栈, 根据多层级 context 合并成一个 contextValue 值。
  `completeWork 的 popTreeContext`出栈

### 如何完成父子多层 context 内容对象的合并?

- 如, 父 context`{ name: 'Tom', age: 20 }`, 子 context`{ name: 'Jack' }`
  在这个范围下组合出来的 contextValue 是`{ name: 'Jack', age: 20 }`

- `processChildContext` 方法: 得到父级 context 与 自身 context 合并其结果对象, 并缓存起来。
